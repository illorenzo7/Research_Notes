\documentclass[12pt]{article}

% standard packages
\usepackage{amsmath, bm, empheq, mathrsfs, natbib, cancel}

% normal margins
\usepackage[margin=1in]{geometry}

% plane blue hyperlinks
\usepackage[colorlinks]{hyperref}
\hypersetup{
	colorlinks = true,
	linkcolor=blue,
	citecolor=blue
}

% common macros
\input{../macros.tex}

% other macros
\newcommand{\vecrot}{\bm{\Omega}}
\newcommand{\vecr}{\bm{r}}
\newcommand{\xpar}{x_\parallel}
\newcommand{\epar}{\e_\parallel}
\newcommand{\upar}{u_\parallel}
\newcommand{\uperp}{\vecu_\perp}
\newcommand{\vecf}{\bm{F}}

% date, author, title
\date{\today}
\author{Loren Matilsky}
\title{An energy-conserving anelastic approximation for strongly stably-stratified fluids}
\begin{document}
	\maketitle
	\section{Introduction}
	Abstract: When acoustic oscillations are believed to be irrelevant to the dynamics of an astrophysical fluid, it is useful to employ simplifying approximations to the equations of motion. The two most common of these (which are usually used to treat convection problem) are the Boussinesq approximation (when the background density does not significantly vary across the fluid layer) and the anelastic approximation (when the background density does vary significantly). There are many distinct forms of the anelastic approximation in the literature, and it has often been remarked that most of these do not properly conserve energy when the fluid is stable to convection. Here we show that the anelastic equations derived by Gough (1969) in fact do conserve energy for arbitrary motions of the fluid, even for strongly stratified background stratification. The key properties of these equations that allow them to conserve energy are (1) the absence of the Lantz-Braginsky-Roberts approximation in the momentum equation and (2) the inclusion of additional terms in the energy equation, which allow the proper conversion between kinetic and potential energy via compressive work. We show that the scaling analysis of Gough (1969), which implicitly assumed a single typical value of the background entropy gradient, can be valid even for convective overshoot, where the entropy gradient changes from slightly unstable in the convective region to stable (sometimes strongly so) in the overshoot region. The requirement for the anelastic equations to be valid for convective overshoot is that the buoyancy frequency be significantly less than the acoustic cutoff frequency. 
	
	The anelastic equations originally consisted of an approximation to the continuity and momentum equations, derived by assuming small thermal perturbations about a nearly adiabatically stratified hydrostatic reference atmosphere \citep{Batchelor1953,Charney1960}. The thermodynamics of the problem thus become ``linear," in the sense that products of thermodynamic variables reduced to linear expressions in the first-order perturbations. The two key consequences of linearized thermodynamics are divergenceless mass flux (i.e., $\Div(\rhoref\vecu)\equiv0$, where $\rhoref$ is the background density and $\vecu$ the fluid velocity; this takes the place of the $\Div\vecu=0$ condition from the Boussinesq approximation) and the first-order buoyancy force (associated with the first-order perturbed density and pressure) being the primary driver of the flow. \citep{Ogura1962} formalized the approximation by expanding the equations of motion in a small parameter $\epsilon$, representing the relative variation of potential temperature across the fluid layer, and hence the relative magnitude of the thermal perturbations. They recovered the equations of \citet{Batchelor1953,Charney1960} and showed an assumption about the \textit{time scale} of the motion was necessary, in addition to the assumption of small thermal perturbations. Namely, the dynamical time scale of the buoyantly driven flows must be $O(\epsilon^{-1/2})$ times \textit{larger} than the sound crossing time of the region. Sound waves, which imply rapid temporal variations on the order of the sound crossing time, are thus absent from the anelastic equations, making them ideal for numerical integration, where large time steps are required to capture significant evolution of the system. 
	
	In the original asymptotic expansion of \citet{Ogura1962}, the energy equation was replaced by a heat (or entropy) equation for the evolution of potential temperature, \textit{before} non-dimensionalizing the equations. The approach of considering the entropy equation instead of the energy equation before nondimensionalization is repeated in all modern implementations of the anelastic approximation that we are aware of (e.g., \citealt{Gilman1981,Lipps1982,Glatzmaier1984,Lantz1992,Braginsky1995,Lantz1999,Clune1999,Rogers2005,Brown2012,Vasil2013,Wilczyski2022}). The resulting energy equation is also used in all numerical codes we are aware of that utilize the anelastic equations, for example, the {\ash} code \citep{Brun2004}, the \texttt{MagIC} code \citep{Gastine2012}, the {\rayleigh} code \citep{Featherstone2016a,Featherstone2023}, the {\eulag} code \citep{Smolarkiewicz2004}, and the \texttt{Dedalus} code \citep{Burns2020,Brown2020}. 
	
	While nondimensionalizing the heat equation instead of the energy equation may at first appear to be an arbitrary and innocuous choice, we show in the present work that it leads to an asymptotically inconsistent set of equations that do not conserve energy when the background is stably stratified. \citet{Gough1969}, by contrast, took a different approach than \citet{Ogura1962} and performed a formal asymptotic expansion in $\epsilon$ while nondimensionalizing the energy equation. We now show that this equation set, which we dub the ``Energy-conserving Generalized Gough" (EGG) anelastic equations, conserve energy for arbitrary fluid motions and for all hydrostatic background states (whether stably or unstably stratified).
	
	\section{The fully compressible equations considered by \citet{Gough1969}}
	We begin by writing down the unapproximated fully compressible equations of motion for a nonrotating nonmagnetic fluid considered by \citet{Gough1969}. These are the continuity equation 
	\begin{align}\label{eq:cont}
		\pderiv{\rho}{t}=-\Div(\rho\vecu) 
	\end{align}
	the momentum equation,
	\begin{subequations}\label{eq:mom}
	\begin{align}
		\pderiv{}{t}(\rho\vecu)=-\Div(\rho\vecu\vecu) - \nabla P +\rho\vecg +\Div \overleftrightarrow{D},\label{eq:mommain}\\
		\where D_{ij} = \mu\left(\pderiv{u_i}{x_j} + \pderiv{u_j}{x_i} - \frac{2}{3}(\Div\vecu)\delta_{ij}\right),\label{eq:momvisc}
	\end{align}
	\end{subequations}
	the energy equation,
	\begin{align}\label{eq:en}
		\pderiv{}{t}(\rho U) + \Div(\rho U\vecu) + P\Div\vecu = D_{ij}\pderiv{u_i}{x_j} + Q - \Div\vecf,
	\end{align}
	and as general equation of state,
	\begin{align}\label{eq:eos}
		U = U(P,T).
	\end{align}
	Here, $t$ is the time, the $x_i$ are Cartesian spatial coordinates, $\rho$ is the density, $P$ the pressure, $T$ the temperature, $U$ the internal energy per unit mass, $\mu$ the dynamic viscosity, $\vecg$ the graviational acceleration field, $Q$ an internal heat source, $\vecf$ the combined conductive and radiative heat flux.  The symbol ``$\leftrightarrow$'' in the viscous stress tensor $\overleftrightarrow{D}$ denotes a second-order tensor, as does the dyadic notation $\vecu\vecu$. The subscripts $i$ and $j$ (taking the values 1, 2,3 ) denote vector or tensor components in any of the Cartesian spatial directions.  We use the Einstein summation convention and $\delta_{ij}$ denotes the Kronecker delta. 
	
	These equations are not written in the exact form of \citet{Gough1969} but are mathematically equivalent. Note that the left-hand side (LHS) of Equation \eqref{eq:en} can be written in several other forms which will prove useful: 
	\begin{align}\label{eq:enlhs}
		\pderiv{}{t}(\rho U) + \Div(\rho U\vecu) + P\Div\vecu = \rho\matderiv{U} - \frac{P}{\rho}\matderiv{\rho} = \rho\matderiv{h} -\matderiv{P}=\rho T \matderiv{S},
	\end{align}
	where 
	\begin{align}\label{eq:matderiv}
		\matderiv{}{}\define \pderiv{}{t} + \ugrad
	\end{align}
	is the material (or Lagrangian) derivative,
	\begin{align}\label{eq:enthalpy}
		h\define U + \frac{P}{\rho}
	\end{align}
	is the specific enthalpy, and
	\begin{align}\label{eq:entropy}
		S = S(P,T)
	\end{align}
	is the specific entropy. 
	
	It will also be helpful to define the following fluid properties associated with the generalized equations of state \eqref{eq:eos} and \eqref{eq:entropy}: the specific heat at constant pressure, 
	\begin{align}\label{eq:cp}
		\cpcap\define T\left(\pderiv{S}{T}\right)_P,
	\end{align}
	the squared adiabatic sound speed,
	\begin{align}\label{eq:cs2}
		\cs^2\define \left(\pderiv{P}{\rho}\right)_S,
	\end{align}
	and the thermal expansion coefficient,
	\begin{align}
		\delta\define-\left(\pderiv{\ln\rho}{\ln T}\right)_P.
	\end{align}
	\clearpage
	\newpage
	%\bibliography{/Users/loren/Desktop/Paper_Library/000_bibtex/library_propstyle, 
		\bibliography{/Users/loren/Desktop/Paper_Library/000_bibtex/library, 
			/Users/loren/Desktop/Paper_Library/000_bibtex/proceedings,
			/Users/loren/Desktop/Paper_Library/000_bibtex/books}
		\bibliographystyle{aasjournal}
	%, therefore getting the properties of internal gravity waves badly wrong.
\end{document}