% document type and language
\documentclass[12pt]{article}

% standard packages
\usepackage{amsmath, bm, empheq, mathrsfs, natbib, cancel}
% label equations by section first, then equation in that section
\numberwithin{equation}{section}

% normal margins
\usepackage[margin=1in]{geometry}

% plane blue hyperlinks
\usepackage[colorlinks]{hyperref}
\hypersetup{
	colorlinks = true,
	linkcolor=blue,
	urlcolor=blue,
	citecolor=blue
}

% common macros
\input{../macros.tex}

% other macros
\newcommand{\nad}{n_{\rm{ad}}}
\newcommand{\dimm}{_{\rm{dim}}}
\newcommand{\cz}{_{\rm{CZ}}}
\newcommand{\wl}{_{\rm{WL}}}
\newcommand{\dcool}{\delta_{\rm{cool}}}
\newcommand{\vecf}{\bm{F}}

\newcommand{\csa}{c_{{\rm s}a}}
\newcommand{\cpa}{C_{{\rm p}a}}
\newcommand{\tmpa}{T_{\rm a}}
\newcommand{\rhoa}{\rho_{\rm a}}
\newcommand{\prsa}{P_{\rm a}}

% date, author, title
\date{\today}
\author{Loren Matilsky}
\title{Non-Dimensionalization of an Anelastic Stable--Unstable Layer in {\rayleigh}}

%\allowdisplaybreaks
\begin{document}
	\maketitle
	\section{General Equations Solved in {\rayleigh}}
	In general (with rotation and magnetism), {\rayleigh} time-evolves a set of coupled PDEs for the 3D vector velocity $\vecu$, vector magnetic field $\vecb$, pressure perturbation $\prsprime$ (perturbation away from the ``reference-state" pressure $\prstilde$), and entropy perturbation $\entrprime$ (perturbation away from $\entrtilde$). Note that $\entrprime$ can also be interpreted as a temperature perturbation in Boussinesq mode. For more details, see {\rayleigh}'s \href{https://rayleigh-documentation.readthedocs.io/en/latest/doc/source/User_Guide/physics_math_overview.html#the-system-of-equations-solved-in-rayleigh}{Documentation}. 
	
	We use spherical coordinates: $r$ (spherical radius), $\theta$ (colatitude), $\phi$ (azimuth angle), as well as cylindrical coordinates: $\lambda=r\sint$ (cylindrical radius, or moment arm) and $z=\cost$ (axial coordinate). In general, $\e_q$ denotes a position-dependent unit vector in the direction of increasing $q$. With this notation, the full PDE-set solved by {\rayleigh} is:
	\begin{align}
	\Div(f_1\vecu) &= 0\label{eq:contgen},\\
	\Div \vecb &= 0,
\end{align}
\begin{subequations}\label{eq:momgen}
	\begin{align}
		f_1\left(\matderiv{\vecu}+c_1\ez\times\vecu\right) =&\ c_2f_2 S\er - c_3 f_1\nabla\left(\frac{P}{f_1} \right), \nonumber\\
		& +c_4(\curl\vecb)\times\vecb+c_5\Div\bm{D},\\
		\where D_{ij} \define&\ 2f_1 f_3 \left[e_{ij} - \frac{1}{3}(\Div\vecu) \delta_{ij} \right]\label{eq:dstressgen}\\
		\andd e_{ij} \define&\ \frac{1}{2}\left(\pderiv{u_i}{x_j} + \pderiv{u_j}{x_i} \right),\label{eq:estressgen}
	\end{align}
\end{subequations}
\begin{align}\label{eq:engen}
	f_1 f_4 \left(\matderiv{S} + c_{11}f_{14} u_r\right) =&\ c_6\Div(f_1 f_4 f_5 \nabla S) \nonumber \\
	&+ c_{10}f_6(r) + c_8 c_5 D_{ij}e_{ij} +c_9c_7f_7|\curl\vecb|^2,
\end{align}
\begin{align}\label{eq:indgen}
	\andd \pderiv{\vecb}{t} = \curl\left[\vecu\times\vecb - c_7 f_7\curl\vecb\right],
\end{align}
where $D/Dt\define \partial/\partial t+\vecu\cdot\nabla$ denotes the material derivative. 

The shell geometry (i.e., aspect ratio) and reference state fully define the problem. (I have always found that initial conditions seem to ultimately be irrelevant to the final state of the system, although this of course doesn't rule out hysteresis effects from occurring in future cases). The reference state is defined by the spherically-symmetric, time-independent functions $f_i=f_i(r)$ and constants $c_j$. By adjusting the $f_i$ and $c_j$, the user can choose between a Boussinesq or anelastic approximation (the specific form of each approximation is described more fully in the  \href{https://rayleigh-documentation.readthedocs.io/en/latest/doc/source/User_Guide/physics_math_overview.html#the-system-of-equations-solved-in-rayleigh}{Documentation}), choose any arbitrary nondimensionalization of these two equation sets, and/or set the nondimensional parameters (Rayleigh number, Prandtl number, etc.) of the problem.  {\rayleigh} has built-in modes to set the $f_i$ and $c_j$ for the single-layer (i.e., either convectively stable or unstable, but not both) Boussinesq approximation (nondimensional only) and anelastic approximation (either dimensional or two choices of nondimensional). These modes are chosen via the choices $\texttt{reference\_type = 1,2,3}$ or $\texttt{5}$. 

More complex systems, which {\rayleigh} also supports, require the user to manually change the $f_i$ and $c_j$. This can be done by editing an input binary file that {\rayleigh} reads upon initialization and setting $\texttt{reference\_type = 4}$ . This document essentially describes how to produce such a ``custom" input file (here called {\texttt{customfile}}) for a coupled stable--unstable anelastic system, using a variety of chosen time-scales in the nondimensionalization. Note that the $c_j$ can also be over-written at run-time by an ASCII text-file (i.e., the \texttt{main\_input} file), allowing easy changes of the nondimensional numbers for a simulation suite that uses a common reference state---all without modifying the  {\texttt{customfile}}.
	
	\section{Dimensional Anelastic Equations}
	We begin by writing down the full dimensional anelastic fluid equations, as they are usually implemented in {\rayleigh} (more precisely, this corresponds to \texttt{reference\_type = 2}). This form of the anelastic approximation in a spherical shell is derived in, or more accurately, attributed to (since {\rayleigh} ``updates" the reference state slightly differently than the cluge-y \texttt{ASH} implementation), two common sources: \citet{Gilman1981} and \citet{Clune1999}. {\rayleigh}'s dimensional anelastic equation-set is:
	\begin{align}
		\Div(\rhotilde\vecu) &= 0\label{eq:contdim},\\
		\Div \vecb &= 0,
	\end{align}
	\begin{subequations}\label{eq:momdim}
	\begin{align}
		\rhotilde\left(\matderiv{\vecu}+2\Omega_0\ez\times\vecu\right) = &  \left(\frac{\rhotilde \gtilde}{\cpcap}\right) \entrprime\er-\rhotilde\nabla\left( \frac{\prsprime}{\rhotilde} \right), \nonumber\\
		&+ \frac{1}{\mu}(\curl\vecb)\times\vecb+\Div\bm{D},\\
		\where D_{ij} &\define 2\rhotilde\nutilde \left[e_{ij} - \frac{1}{3}(\Div\vecu) \delta_{ij} \right]\label{eq:dstressdim}\\
		\andd e_{ij} &\define \frac{1}{2}\left(\pderiv{u_i}{x_j} + \pderiv{u_j}{x_i} \right),\label{eq:estressdim}
	\end{align}
	\end{subequations}
	\begin{align}\label{eq:endim}
		\rhotilde\tmptilde \left(\matderiv{\entrprime} + \frac{d\entrtilde}{dr} u_r\right) = &\ \Div(\rhotilde \tmptilde \kappatilde \nabla \entrprime) +Q+ D_{ij}e_{ij} + \frac{\etatilde}{\mu}|\curl\vecb|^2,
	\end{align}
	\begin{align}\label{eq:inddim}
	\andd \pderiv{\vecb}{t} = \curl\left(\vecu\times\vecb - \etatilde\curl\vecb\right).
	\end{align}
	Here, the thermal variables $\rho$, $T$, $P$, and $S$ refer to the density, temperature, pressure, and entropy (respectively). The tildes denote the reference state and the primes denote the (assumed small) perturbations from the reference state. More specifically, the essence of the anelastic approximation involves assuming all relative thermal perturbations ($\rhoprime/\rhoa$, $\tmpprime/\tmpa$, $\prsprime/\prsa$, and $\entrprime/\cpcap$) are $O(\epsilon)$, where $\epsilon\ll1$ (e.g., \citealt{Ogura1962,Gough1969} and \citealt{Matilsky2024b}, coming soon!). Here, the ``a" subscripts denote ``typical reference-state values" and $\epsilon$ is also the same (small) size as the typical squared Mach number of the flow. 
	
	Other background quantities that appear are the full gravitational acceleration $\gtilde$, the momentum, thermal, and magnetic diffusivities ($\nutilde$, $\kappatilde$, and $\etatilde$ , respectively; these all have c.g.s. units of $\stoke$), the internal heating $Q$, the frame rotation rate $\Omega_0$, the specific heat at constant pressure $\cpcap$, and the vacuum permeability $\mu$ ($=4\pi$ in c.g.s. units). The equations are written in a frame rotating with angular velocity $\Omega_0\ez$ and the centrifugal force is neglected. Note that $\cpcap$ is always assumed to be constant, while in a real stellar (or gas-giant) structure model, it should really vary in radius.
	
	\subsection{The reference state}
	Ideally, the reference state would be chosen based on a state-of-the-art structure model, incorporating all known physics. In the Sun, for example, this structure model is fairly well agreed-upon (e.g., \citealt{ChristensenDalsgaard1996}); but in the Jovian case, much less so (e.g., \citealt{Guillot2005}). In our (or possibly just Loren's) philosophy, the form of the reference state itself matters far less than the fact that we cannot approach realistic astrophysical conditions for stars or gas giants. Therefore, we choose the reference state somewhat arbitrarily. Put another way, we choose the $f_i$ to be slightly wrong and are consoled by the fact that the $c_j$ are \textit{incredibly} wrong. 
	
	We do, however demand that the gas be in hydrostatic balance,
	\begin{align}\label{eq:dimhydro}
	\frac{d\tilde{P}}{dr}= -\rhotilde \gtilde,
	\end{align}
	be perfect,
	\begin{align}
	\prstilde &= \rhotilde\gasconst \tmptilde,\label{eq:dimidgas}
	\end{align}
	and be in local thermodynamic equilibrium (LTE), 
	\begin{subequations}\label{eq:dimfirstlaw}
	\begin{align}
		\frac{1}{\cpcap}\frac{d\entrtilde}{dr}&=\frac{1}{\gamma}\frac{d\ln\tmptilde}{dr} - \frac{\gamma - 1}{\gamma}\frac{d\ln\rhotilde}{dr}\label{eq:dimfirstlawtmprho}\\
		&=\frac{1}{\gamma}\frac{d\ln\prstilde}{dr} - \frac{d\ln\rhotilde}{dr}\label{eq:dimfirstlawprsrho}\\
		&= \frac{d\ln\tmptilde}{dr} - \frac{\gamma - 1}{\gamma}\frac{d\ln\prstilde}{dr}\label{eq:dimfirstlawtmpprs}
	\end{align}
	\label{eq:firstlaw3}
\end{subequations}

Here, $\gasconst=\cpcap-\cvcap$ is the gas constant, $\cvcap$ is the specific heat at constant volume (or equivalently, constant density), and $\gamma=\cpcap/\cvcap$ is the ratio of specific heats. All are assumed to be constant (that is the definition of a perfect, not just ideal, gas). 

Really, Equation \eqref{eq:dimfirstlaw} is simply an expression of the first law of thermodynamics. It doesn't further constrain the structure problem, but rather introduces a new unknown, i.e., the entropy $\entrtilde$. In an ideal world, we would therefore also demand a condition for thermal (in stars, ``radiative") equilibrium. This would generate another equation constraining $\rhotilde$ and $\tmptilde$ in addition to Equations \eqref{eq:dimhydro}--\eqref{eq:dimfirstlaw}, and thus fully define the structure problem. Let's consider radiative equilibrium first, since this applies in stars. Radiative diffusion makes the structure problem there much easier than for the (relatively cold) matter in gas giants, since we only need consider the opacity of a fully ionized gas. Under the radiative diffusion approximation, the equation of thermal equilibrium is
\begin{subequations}\label{eq:dimradequil}
\begin{align}
	\heattilde - \Div\fradtilde &= \Div\fconvtilde\label{eq:dimradequil1},\\
	\where \fradtilde &\define  -\rhotilde \cpcap\kradtilde \nabla\tmptilde=-\rhotilde \cpcap\kradtilde \frac{d\tmptilde}{dr}\er,\label{eq:dimradequil2}\\
	 \Div\fconvtilde &\define \begin{cases} 0 \five &\text{for}\five \nabla_{\rm rad} <\nabla_{\rm ad}\ \text{(stable to convection)}\\
		\frac{1}{r^2}\frac{d}{dr}\left(\rhotilde r^2\kradtilde\frac{d\tmptilde_{\rm ad}}{dr}\right) &\text{for}\five \nabla_{\rm rad} >\nabla_{\rm ad}\ \text{(unstable to convection)}\
		\end{cases},\label{eq:dimradequil3}\\
		\nabla_{\rm rad}&\define \frac{d\ln\tmptilde_{\rm rad}/dr}{d\ln\prstilde/dr} = -\frac{\gamma-1}{\gamma}\frac{\lstar}{4\pi r^2 \gtilde \rhotilde \kradtilde},\label{eq:dimradequil4}\\
		\andd \nabla_{\rm ad}&\define  \left(\frac{d\ln\tmptilde}{d\ln\prstilde}\right)_{\rm ad} = \frac{\gamma-1}{\gamma}.
\end{align}
\end{subequations}
Here, $\heattilde=\heattilde(\rhotilde,\tmptilde)$ is the reference-state internal heating per unit volume (likely due to nuclear burning in the core, or in Jupiter, Helmholtz contraction), $\lstar$ is the total luminosity (power output) of the object, and $\kradtilde=\kradtilde(\rhotilde,\tmptilde)$ is the reference-state radiative diffusivity (units $\stoke$), which in turn depends on the opacity. Note that $\heattilde$ and the $Q$ used by {\rayleigh} have physically quite different origin. 

In practice, Equations \eqref{eq:dimhydro}--\eqref{eq:dimradequil} would be solved by integrating inward from an appropriate boundary condition at the photosphere. At each point, the relative values of $\nabla_{\rm rad}$ and $\nabla_{\rm ad}$ would be compared to determine which of the two forms of Equation \eqref{eq:dimradequil3} to use. Doing so implicitly adheres to the mixing-length assumption, because it is implied that ``convection is locally determined." Of course, convection is a \textit{global} phenomenon. The fully compressible system could theoretically lead to a horizontally averaged state where locally, $\gradrad<\gradad$, but vigorous global convective modes still exist there. This would make the structure model inaccurate. 

This is assuming the radiative conduction of heat dominates over the molecular ($\kappatilde$) conduction of heat. Clearly, subtracting Equation \eqref{eq:dimradequil} from the fully compressible heat equation would yield the combination 
\begin{subequations}
	\begin{align}
		\heatprime - \Div(&\fradprime + \fcondprime),\\
		\where \fradprime &\define \left(\frac{\rhoprime}{\rhotilde} + \frac{\kradprime}{\kradtilde} + \frac{d\tmpprime/dr}{d\tmptilde/dr}\right)\fradtilde
	\end{align}
\end{subequations}

% After the structure problem was solved  %Note that $\heattilde$ is a reference-state quantity (and thus assumed to be spherically-symmetric and time-independent) but should be interpreted as $\heattilde=-\Div\frad$, where $\frad$ is the radiative heat flux. Properly, $\heattilde$ should be proportional to the radiative diffusivity $\kappa_{\rm rad}$ (which takes on a specific form in the radiative diffusion approximation, derivable from the opacity) and to the gradient of the total temperature $\tmptilde + T$; and $C$ should be calculated using complicated near-surface physics. 


	In {\rayleigh}, a convective layer is usually driven by a combination of internal heating and the thermal boundary conditions (which are conditions on $\entrtilde$), that together ensure that an imposed energy flux is transported throughout the layer in a steady state. (Note that energy could also be forced across the layer by fixing the entropy $\entrtilde$ at each boundary, such that an ``adverse" (negative) radial entropy gradient is obtained in a steady state).   \textbf{In the Jupiter models, which will have both internal heating and cooling, we will set $\pderivline{S}{r}\equiv0$ at both the top and bottom boundary (no conduction in or out), and the flux of energy across the system will be imposed purely by the combination $Q-C$}. 
	
	%Note that Equation \eqref{eq:estressdim} is only valid in a Cartesian coordinate system ($x_1$, $x_2$, $x_3$) (with $i$ and $j$ running over 1, 2, 3) and is translated into spherical coordinates before being used in Rayleigh. 
	
	Also, we recall the relation
	\begin{align}
		\dsdr = \cp \frac{\nsqtilde}{\gtilde},
	\end{align}
	where $\nsqtilde$ is the squared buoyancy frequency, which we will use in favor of $\dsdrline$ in subsequent equations. 
	
	Note that the original equations in \citet{Gilman1981} and \citet{Clune1999} were derived assuming a nearly-adiabatic background state (i.e., $\dsdrline\approx0$). \citet{Brown2012} and \citet{Vasil2013} have raised concerns about using various anelastic approximations in stable layers due to non-energy-conserving gravity waves. Should we be concerned?
	
	\section{Non-Dimensional Scheme}
	We now non-dimensionalize Equations \eqref{eq:contdim}--\eqref{eq:inddim}, according to the following scheme:
	\begin{subequations}\label{eq:ndscheme}
	\begin{align}
		\nabla &\rightarrow \frac{1}{H}\nabla,\\
		t &\rightarrow \tau t,\\
		\vecu &\rightarrow \frac{H}{\tau} \vecu,\\
		S &\rightarrow (\Delta S) S,\\
		P &\rightarrow \tilde{\rho} \frac{H^2}{\tau^2} P,\\
		\vecb &\rightarrow (\mu\tilde{\rho})^{1/2}\frac{H}{\tau} \vecb,\\ 
		\rhotilde &\rightarrow \tilde{\rho} \rhotilde, \\
		\tmptilde &\rightarrow \tilde{T} \tmptilde,\\
		\gtilde &\rightarrow \tilde{g} \gtilde,\\
		\nsqtilde &\rightarrow \widetilde{N^2} \nsqtilde,\\
		\nutilde &\rightarrow \tilde{\nu}\nutilde,\\
		\kappatilde &\rightarrow \tilde{\kappa}\kappatilde,\\
		 \etatilde &\rightarrow \tilde{\eta}\etatilde,\\ 
		Q &\rightarrow \tilde{C} Q,\\
		\andd C &\rightarrow \tilde{Q} C.
	\end{align}
	\end{subequations}
	Here, $H$ is a typical length-scale, $\tau$ a typical time-scale, and $\Delta S$ a typical (\textit{estimated}) entropy scale (in Rayleigh-B\'enard-type convection, the true entropy difference is imposed directly, but we will set the true value indirectly via heating and cooling functions). On the right-hand-sides of Equation \eqref{eq:ndscheme} and in the following non-dimensionalizations, all fluid variables, coordinates, and background-state quantities are understood to be non-dimensional. The tildes refer to``typical values" of the (dimensional) reference-state functions. These typical values will be a volume-average over the convection zone (CZ) of the shell, except for $\widetilde{N^2}$, which will be a volume-average over the stably stratified weather layer (WL). Since cooling takes out what heating dumps in, we will normalize such that $\tilde{C}=\tilde{Q}$. 
	
	Below, we will assume the time-scale is either a thermal diffusion time (i.e., $\tau=H^2/\tilde{\nu}$) or a rotational time-scale [i.e., $\tau=(2\Omega_0)^{-1}$]. %To describe the reference state, we will consider three cases for a given function's ``typical value": Its value at the inner shell boundary, its value at the outer shell boundary, or its value volume-averaged over the shell. 
	
	\section{Non-Dimensional Equations, Non-Rotating ($\tau=H^2/\tilde{\kappa}$)}
	In this case, Equations \eqref{eq:contdim}--\eqref{eq:inddim} become 
	\begin{align}
	\Div[\rhotilde\vecu] &= 0\label{eq:contndvisc},\\
	\Div \vecb &= 0,
\end{align}
\begin{subequations}\label{eq:momndvisc}
	\begin{align}
		\rhotilde\left[\matderiv{\vecu}+\frac{\pr}{\ek}\ez\times\vecu\right] = &\ \pr\ra\rhotilde\gtilde S\er         -\rhotilde\nabla\left[ \frac{P}{\rhotilde} \right], \nonumber\\
		&\ +(\curl\vecb)\times\vecb +\pr\Div\bm{D},\\
		\where D_{ij} &\define 2\rhotilde\nutilde \left[e_{ij} - \frac{1}{3}(\Div\vecu) \delta_{ij} \right]\\
		\andd e_{ij} &\define \frac{1}{2}\left(\pderiv{u_i}{x_j} + \pderiv{u_j}{x_i} \right),
	\end{align}
\end{subequations}
\begin{align}\label{eq:enndvisc}
	\rhotilde\tmptilde\left[ \matderiv{S} + \frac{\bu}{\ra}\frac{\nsqtilde}{\gtilde} u_r\right]  = &\ \Div[\rhotilde \tmptilde \kappatilde \nabla S] \nonumber \\
	&+ Q(r) -C + \frac{\di}{\ra} D_{ij}e_{ij} + \frac{\di}{\prm\ra} \etatilde|\curl\vecb|^2,
\end{align}
\begin{align}\label{eq:indndvisc}
	\andd \pderiv{\vecb}{t} = \curl\left[\vecu\times\vecb - \frac{\pr}{\prm}\etatilde\curl\vecb\right].
\end{align}	

The non-dimensional numbers appearing are:
\begin{subequations}
\begin{align}
	\ra &\define \frac{\tilde{g} H^3}{\tilde{\nu} \tilde{\kappa}} \frac{\Delta S}{\cp}\five\text{(Rayleigh number)},\\ 
	\pr &\define \frac{\tilde{\nu}}{\tilde{\kappa}}\five\text{(Prandtl number)},\\
	\prm &\define \frac{\tilde{\nu}}{\tilde{\eta}}\five\text{(magnetic Prandtl number)},\\
	\ek &\define \frac{\tilde{\nu}}{2\Omega_0H^2}\five\text{(Ekman number)},\\	
	\bu &\define \frac{\widetilde{N^2}H^4}{\tilde{\nu}\tilde{\kappa}}\five\text{(buoyancy number)},\\
	\andd \di &= \frac{\tilde{g}H}{\cp\tilde{T}}\five\text{(dissipation number)},
\end{align}
\end{subequations}
Note that in our convention, the dissipation number is not an independent control parameter, but a function of the non-dimensional parameters characterizing the reference state (this will be seen in Section \ref{sec:ref}). 

Note that we have chosen the entropy-scale (and thus the Rayleigh number) based on the internal heating:
\begin{subequations}
\begin{align}
	\Delta S &\define \frac{\tilde{Q}\tau}{\tilde{\rho}\tilde{T}} = \frac{\tilde{Q}H^2}{\tilde{\rho}\tilde{T}\tilde{\kappa}}\label{eq:dsnonrot}\\
	\andd \ra &\define \frac{\tilde{g} \tilde{Q} H^3\tau}{\tilde{\rho}\tilde{T}\cp\tilde{\nu} \tilde{\kappa}} =  \frac{\tilde{g} \tilde{Q} H^5}{\tilde{\rho}\tilde{T}\cp\tilde{\nu} \tilde{\kappa}^2},\label{eq:ranonrot}\\ 
\end{align}
\end{subequations}
where the first equality in each equation is general (it holds for any choice of time-scale $\tau$) and the second equality is specific to the non-rotating case. Essentially, we have assumed that the heating (or cooling) operates on the time-scale $\tau$ before the fluid parcel buoyantly moves to another part of the shell, carrying with it an entropy perturbation $\Delta S$ (in the non-rotating case, this should happen on the thermal dissipation time-scale $\tau=H^2/\tilde{\kappa}$). 

The user is thus free to choose the shapes of $Q$ and $C$, but not their amplitude, since they must have unity volume-averages over the CZ. 

The buoyancy number $\bu$ is the ratio of the typical squared buoyancy frequency to the thermal and viscous diffusion times. It is essentially a ``second (stable) Rayleigh number", and measures the stiffness of the stable layer (recall $\widetilde{N^2}$ refers to the typical value of $\nsqtilde$ in the WL). The buoyancy number is independent of the Rayleigh number, which estimates the ultimate instability of the CZ. 

\section{Non-Dimensional Equations, Rotating [$\tau=(2\Omega_0)^{-1}$]}
In the previous section, $t$ (and things with time in the dimensions) was implied to mean $(\tilde{\kappa}/H^2) t_{\rm{dim}}$, where $t_{\rm{dim}}$ was the dimensional time. We now want to use a new non-dimensional time, $t_{\rm{new}}= \Omega_0t_{\rm{dim}} = (\pr/\ek)t$. We can thus find the new equations easily from Equations \eqref{eq:contndvisc}--\eqref{eq:indndvisc}. Every place we see a time dimension, we recall $t=(\ek /\pr)t_{\rm{new}}$, so we multiply the place where the time-dimension appears by $(\ek/\pr)$ and drop the ``new" subscript [e.g., $t\rightarrow (\ek/\pr)\ t$, $\vecu\rightarrow(\pr/\ek)\vecu$, etc.]  

Note that we should now choose a different typical entropy-scale and corresponding Rayleigh number:
\begin{subequations}
	\begin{align}
		\Delta S^*&\define \frac{\tilde{Q}\tau}{\tilde{\rho}\tilde{T}} = \frac{\tilde{Q}}{2\Omega_0\tilde{\rho}\tilde{T}}\label{eq:dsrot}\\
		\andd \ra &\define \frac{\tilde{g} \tilde{Q} H^3\tau}{\tilde{\rho}\tilde{T}\cp\tilde{\nu} \tilde{\kappa}} =  \frac{\tilde{g} \tilde{Q} H^3}{2\Omega_0\tilde{\rho}\tilde{T}\cp\tilde{\nu} \tilde{\kappa}}.\label{eq:rarot}
	\end{align}
\end{subequations}
The reasoning here is that under the influence of rapid rotation, the life-times of upflows or downflows are no longer set by the thermal dissipation time, but by the rotation period. Thus, the heating or cooling of a fluid parcel occurs on a shorter time-scale, leading to a smaller entropy difference across the shell than in the non-rotating case with the same amount of heating. Of course, neither Equations \eqref{eq:dsnonrot} or \eqref{eq:dsrot} are particularly convincing estimates and there is a large degree of uncertainty in the actual magnitude of typical entropy perturbations. We can only see how good these estimates are (after the fact) by checking if the achieved (non-dimensional) entropy difference across the shell winds up being close to unity. 

We thus find (after rearranging terms),
\begin{align}
	\Div[\rhotilde\vecu] &= 0\label{eq:contndrot},\\
	\Div \vecb &= 0,
\end{align}
\begin{subequations}\label{eq:momndrot}
	\begin{align}
		\rhotilde\left[\matderiv{\vecu} + \ez\times\vecu\right] = &\ \ramod \rhotilde\gtilde S\er         -\rhotilde\nabla\left[ \frac{P}{\rhotilde} \right], \nonumber\\
		&+(\curl\vecb)\times\vecb + \ek \Div\bm{D},\\
		\where D_{ij} &\define 2\rhotilde\nutilde \left[e_{ij} - \frac{1}{3}(\Div\vecu) \delta_{ij} \right]\\
		\andd e_{ij} &\define \frac{1}{2}\left(\pderiv{u_i}{x_j} + \pderiv{u_j}{x_i} \right),
	\end{align}
\end{subequations}
\begin{align}\label{eq:enndrot}
	\rhotilde\tmptilde\left[ \matderiv{S}+ \frac{\bumod}{\ramod} \frac{\nsqtilde}{\gtilde} u_r\right]  = &\ \frac{\ek}{\pr} \Div[\rhotilde \tmptilde \kappatilde \nabla S] \nonumber \\
	&+  Q-C + \frac{\di\ek}{\ramod} D_{ij}e_{ij} + \frac{\di\ek}{\prm\ramod} \etatilde|\curl\vecb|^2,
\end{align}
\begin{align}\label{eq:indndrot}
	\andd \pderiv{\vecb}{t} = \curl\left[\vecu\times\vecb - \frac{\ek}{\prm} \eta\curl\vecb\right],
\end{align}	
where we have introduced two modified non-dimensional numbers:
\begin{subequations}
	\begin{align}
		\ramod &\define \frac{\ek^2}{\pr}\ra =  \frac{\tilde{g} }{H\Omega_0^2} \frac{\Delta S}{\cp}=\frac{\tilde{g}\tilde{Q}}{(2\Omega_0)^3\tilde{\rho}\tilde{T}\cp H},\\ 
		\andd \bumod &\define \frac{\ek^2}{\pr}\bu = \frac{\widetilde{N^2}} {4\Omega_0^2} \sim \frac{\tilde{g} }{H\Omega_0^2} =  \frac{1}{\text{geometric\ oblateness}}.
	\end{align}
\end{subequations}

Note that although the ``$\dsdrline$-terms" in the non-dimensionalizations have seemingly different definitions, they are similar, since
\begin{align}
	\frac{\bu}{\ra} \sim \frac{\cp}{\Delta S}\five \andd 	\frac{\bumod}{\ramod} \sim \frac{\cp}{\Delta S^*}.
\end{align}
The only difference is in the different estimates $\Delta S$ and $\Delta S^*$. 

In terms of {\rayleigh}'s $f$'s and $c$'s, we compare Equations \eqref{eq:contndrot}--\eqref{eq:indndrot} to \eqref{eq:contgen}--\eqref{eq:indgen} and find:
\begin{align*}
	\begin{split}
	f_1&\rightarrow \rhotilde\\
	f_2&\rightarrow\rhotilde\gtilde \\
	f_3 &\rightarrow \nutilde\\
	f_4 &\rightarrow \tmptilde\\
	f_5 &\rightarrow \kappatilde\\
	f_6 &\rightarrow Q - C\\
	f_7 &\rightarrow \etatilde\\
	\vdots\\
	f_{14} &\rightarrow \frac{\nsqtilde}{\gtilde}
\end{split}
\begin{split}
c_1 &\rightarrow 1\\
c_2 &\rightarrow \ramod\\
c_3 &\rightarrow 1\\
c_4 &\rightarrow 4\\
c_5 &\rightarrow \ek\\
c_6 &\rightarrow \ek/\pr\\
c_7 &\rightarrow \ek/\prm\\
c_8 &\rightarrow \di/\ramod\\
c_9 &\rightarrow \di/\ramod\\
c_{10} &\rightarrow 1\\
c_{11} &\rightarrow \bumod/\ramod
\end{split}
\end{align*}
\section{Hydrostatic, Ideal-Gas, Jovian Stable--Unstable Layer}
To model a background CZ and WL in Jupiter, we consider a spherical shell composed of an ideal, hydrostatic gas extending between inner radius $r\inn$ and outer radius $r\out$. An assumed transition in convective stability occurs near an intermediate radius $r_0$, over width $\delta$. More specifically, we choose quartic matching of the entropy gradient between the two layers:
\begin{align}
	\frac{d\entrtilde}{dr} &=\psi\wl(r; r_0,\delta),
\end{align}
where
\begin{equation}
  \psi\wl(r;r_0, \delta)\define \begin{cases}
		0 & r\leq r_0 \\
		1 - \left[1 - \Big{(}\frac{r-r_0}{\delta}\Big{)}^2\right]^2 & r_0  < r < r_0+ \delta\\
		1 & r\geq r_0+\delta.
	\end{cases}
	\label{eq:dsdr}
\end{equation}
We also define
\begin{equation}
	\psi\cz(r;r_0, \delta)\define 1 - \psi\wl(r;r_0-\delta,\delta) =  \begin{cases}
		1 & r\leq r_0 \\
		1 - \left[1 - \Big{(}\frac{r-r_0}{\delta}\Big{)}^2\right]^2 & r_0 -\delta  < r < r_0\\
		0 & r\geq r_0.
	\end{cases}
	\label{eq:dsdr}
\end{equation}
$\psi\wl$ thus ``senses" only the WL, and $\psi\cz$ ``senses" only the CZ. 

With this formulation, the CZ is strictly unstable (really, marginally stable, but becomes unstable from the heating and cooling). This ensures that none of the stable gradient ``leaks" into the CZ, as happens with (e.g.) tanh matching. We assume a centrally-concentrated mass so that $\gtilde\propto 1/r^2$. 

It can then be shown that five non-dimensional parameters fully characterize the shell geometry, $\rhotilde$, and $\tmptilde$:
\begin{subequations}
	\begin{align}
		\alpha&\define \frac{r\out-r_0}{r_0-r\inn} \five\text{(WL-to-CZ\ aspect ratio)},\\ 
		\beta &\define \frac{r\inn}{r_0} \five\text{(CZ aspect ratio)},\\
		\gamma&\define \frac{\cp}{\cv}\five\text{(specific-heat ratio)},\\
		\delta &\five\text{(stability transition width)},\\	
		N_\rho &\define \ln\left[\frac{\rhotilde(r_0)}{\rhotilde(r\out)}\right]\five\text{(number of density scale-heights across CZ)},
	\end{align}
\end{subequations}
where $\cv$ is the specific heat at constant volume. 

We choose $H$ to be the thickness of the CZ ($r_0-r\inn=1$ and $r\out-r_0=\alpha$). Thus,
\begin{subequations}
	\begin{align}
		r\inn &=\frac{1-\beta}{\beta},\\
		r_0 &= \frac{1}{1-\beta},\\
		\andd r\out &=  \frac{1}{1-\beta} + \alpha
	\end{align}
\end{subequations}
If we choose $\alpha=0.25$ and $\beta=0.9$, then $(r\inn,r_0,r\out)=(9, 10, 10.25)$. 

With the requirement that the volume-average of $\gtilde$ over the CZ be unity, we require
\begin{align}
	\gtilde &= \left[ \frac{1-\beta^3}{3(1-\beta)^3}    \right]\frac{1}{r^2}.
\end{align}

It can then be shown from the ideal-gas and hydrostatic conditions (e.g., \citealt{Matilsky2023d}) that
\begin{align}\label{eq:tmphat}
	\tmptilde &= e^{\entrtilde}\left[\tmptilde(r_0) - \di\int_{r_0}^r \gtilde(x)  e^{-\entrtilde(x)}dx\right].
\end{align}
and
\begin{align}\label{eq:rhohat}
	\rhotilde &= \rhotilde(r_0) \exp{\left[-\left(\frac{\gamma}{\gamma-1}\right)\entrtilde\right]}\tmptilde^{1/(\gamma-1)},
\end{align}
where (nastily)
\begin{align}\label{eq:digory}
	\di \define \frac{\tilde{g}H}{\cp\tilde{T}} &=  \frac{3 \beta (1 - \beta)^2 (1 - e^{-\nrho/n})} 
	{ (3\beta/2) (1 - \beta^2) (1 - e^{-\nrho/n}) - (1-\beta^3)(\beta-e^{-\nrho/n})},\\
	\tmptilde(r_0)&= \frac{(1-\beta^3)(1-\beta)}{(3\beta/2)(1-\beta^2)(e^{\nrho/n}-1) - (1-\beta^3)(\beta e^{\nrho/n}-1)},\\
	\andd n &\define \frac{1}{1-\gamma}
\end{align}
is the polytropic index of the CZ (note that since $\dsdrline\equiv0$ in the CZ, the stratification of the CZ winds up being an adiabatic polytrope). We have also assumed (without loss of generality) that $\entrtilde(r_0)=0$, so that $\entrtilde\equiv0$ in the CZ). The constant $\rhotilde(r_0)$ ends up not having an analytical expression but can be easily found by integration over the CZ of Equation \eqref{eq:rhohat} (and I should maybe just find $\di$ and $\tmptilde(r_0)$ from integration, too, since I am error-prone).  

To follow \citet{Jones2011} \citet{Heimpel2022} somewhat, we assume $n=2$. Apparently this is a common choice for Jupiter that better approximates its weird equation of state without breaking the ideal gas law. It results in the somewhat strange result $\gamma=3/2$. 

We also simplify our lives and assume constant diffusivities:
\begin{align}
	\nutilde=\kappatilde=\etatilde\equiv 1.
\end{align}

For the heating, we use the typical {\rayleigh} profile $Q\propto \rhotilde \tmptilde$, but ensure that the heating is fully contained in the CZ:
\begin{align}
	Q \propto \rhotilde\tmptilde \psi\cz(r; r_0,\delta)
\end{align} 

For the cooling, we choose a cooling width $\dcool$:
\begin{align}
	C \propto \exp\left[\frac{r-r_0}{\dcool}\right] \psi\cz(r; r_0,\delta)
\end{align}

We thus fully define the following geometry and Jovian-ish reference state:
\begin{subequations}
	\begin{align}
		\alpha &= 0.25,\\
		\beta &= 0.9,\\
		\gamma &= 3/2,\\
		\delta=\dcool &= 0.1\five \text{(may mess with these)},\\
		\andd N_\rho &= 3.
	\end{align}
\end{subequations}
\clearpage
\newpage
%\bibliography{/Users/loren/Desktop/Paper_Library/000_bibtex/library_propstyle, 
	\bibliography{/Users/loren/Desktop/Paper_Library/000_bibtex/library, 
			/Users/loren/Desktop/Paper_Library/000_bibtex/proceedings,
			/Users/loren/Desktop/Paper_Library/000_bibtex/books}
	\bibliographystyle{aasjournal}

\end{document}