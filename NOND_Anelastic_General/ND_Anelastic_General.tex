% document type and language
\documentclass[12pt]{article}

% standard packages
\usepackage{amsmath, bm, empheq, mathrsfs, natbib, cancel}
% label equations by section first, then equation in that section
\numberwithin{equation}{section}

% normal margins
\usepackage[margin=1in]{geometry}

% plane blue hyperlinks
\usepackage[colorlinks]{hyperref}
\hypersetup{
	colorlinks = true,
	linkcolor=blue,
	citecolor=blue
}

% common macros
\input{../macros.tex}

% other macros
\newcommand{\rhond}{\hat{\rho}}
\newcommand{\tmpnd}{\hat{T}}
\newcommand{\gnd}{\hat{g}}
\newcommand{\nund}{\hat{\nu}}
\newcommand{\kappand}{\hat{\kappa}}
\newcommand{\etand}{\hat{\eta}}
\newcommand{\nad}{n_{\rm{ad}}}

% date, author, title
\date{\today}
\author{Loren Matilsky}
\title{General Anelastic Non-Dimensionalization for Rayleigh}

%\allowdisplaybreaks
\begin{document}
	\maketitle
	\section{Dimensional Equations}
	We begin by writing down the full dimensional anelastic fluid equations, as implemented in Rayleigh.
	\begin{align}
		\Div[\rhoref\ofr\vecu] &= 0\label{eq:contdim},\\
		\Div \vecb &= 0,
	\end{align}
	\begin{subequations}\label{eq:momdim}
	\begin{align}
		\rhoref\ofr\left[\matderiv{\vecu}+2\Omega_0\ez\times\vecu\right] = &-\rhoref\ofr\nabla\left[ \frac{P}{\rhoref\ofr} \right] + \left[\frac{\rhoref\ofr g\ofr}{\cp}\right] S\er, \nonumber\\
		&+\Div\bm{D} + \frac{1}{4\pi}(\curl\vecb)\times\vecb,\\
		\where D_{ij} &\define 2\rhoref\ofr\nu\ofr \left[e_{ij} - \frac{1}{3}(\Div\vecu) \delta_{ij} \right]\label{eq:dstressdim}\\
		\andd e_{ij} &\define \frac{1}{2}\left(\pderiv{u_i}{x_j} + \pderiv{u_j}{x_i} \right),\label{eq:estressdim}
	\end{align}
	\end{subequations}
	\begin{align}\label{eq:endim}
		\rhoref\ofr\tmpref\ofr \matderiv{S} = &- \rhoref\ofr\tmpref\ofr \frac{d\sref}{dr} \ur + \Div[\rhoref\ofr \tmpref\ofr \kappa\ofr \nabla S] \nonumber \\
		&+ Q(r) + D_{ij}e_{ij} + \frac{\eta\ofr}{4\pi}|\curl\vecb|^2,
	\end{align}
	\begin{align}\label{eq:inddim}
	\andd \pderiv{\vecb}{t} = \curl(\vecu\times\vecb) - \curl[\eta\ofr\curl\vecb].
	\end{align}
	Here, the thermal variables $\rho$, $T$, $P$, and $S$ refer to the density, temperature, pressure, and entropy (respectively). An overbar on a thermal variable indicates the time-independent, spherically symmetric reference state and the lack of an overbar indicates the (assumed small) deviation from the background (for the entropy, $S/\cp$ is assumed small). The vector velocity is denoted by $\vecu$ and the vector magnetic field by $\vecb$. 
	
	We use standard spherical coordinates $(r,\theta,\phi)$ and cylindrical coordinates $(\lambda,\phi,z) = (r\sint,\phi, r\cost)$, and $\e_q$ in general denotes a position-dependent unit vector in the direction of increasing $q$. The equations are written in a frame rotating with angular velocity $\Omega_0$ and the centrifugal force is neglected. 
	
	The additional reference state variables $\nu\ofr$, $\kappa\ofr$, and $\eta\ofr$ (the momentum, thermal, and magnetic diffusivities, respectively), as well as the gravitational acceleration $g\ofr=G\mstar/r^2$ (where $G$ is the gravitational constant and $\mstar$ the stellar mass), are also assumed to be spherically symmetric and fixed in time. 
	
	Note that the internal heating function $Q(r)$ is also assumed spherically symmetric and fixed in time, but should be interpreted as $-\Div\frad$, where $\frad$ is the radiative heat flux and properly should be proportional to the gradient of the total (background + perturbed) temperature. If the system is a convection zone, it is driven by a combination of internal heating and the thermal boundary conditions (conditions on $S$), that together ensure a stellar luminosity is transported throughout the layer in a steady state. 
	
	Note that Equation \eqref{eq:estressdim} is only valid in a Cartesian coordinate system ($x_1$, $x_2$, $x_3$) (with $i$ and $j$ running over 1, 2, 3) and is translated into spherical coordinates before being used in Rayleigh. 
	
	Finally, we recall the relation,
	\begin{align}
		\dsdr = \cp \frac{N^2(r)}{g\ofr},
	\end{align}
	where $N^2\ofr$ is the squared buoyancy frequency. 
	
	\section{Non-Dimensional Scheme}
	We now non-dimensionalize Equations \eqref{eq:contdim}--\eqref{eq:inddim}, according to the following scheme:
	\begin{subequations}\label{eq:ndscheme}
	\begin{align}
		\nabla &\rightarrow \frac{1}{L}\nabla\label{eq:ndschemenabla},\\
		t &\rightarrow \tau t,\\
		\vecu &\rightarrow \frac{L}{\tau} \vecu,\\
		S &\rightarrow \sigma S,\\
		P &\rightarrow \tilde{\rho} \frac{L^2}{\tau^2} P,\\
		\vecb &\rightarrow (4\pi\tilde{\rho})^{1/2}\frac{L}{\tau} \vecb \label{eq:ndschemeb},\\ 
		\rhoref\ofr &= \tilde{\rho} \rhond\ofr  \label{eq:ndschemerho}, \\
		\tmpref\ofr &= \tilde{T} \tmpnd\ofr,\\
		g\ofr &= \tilde{g} \gnd\ofr,\\
		N^2\ofr &= \widetilde{N^2} \widehat{N^2}\ofr,\\
		\nu\ofr &= \tilde{\nu}\nund\ofr,\\
		\kappa\ofr &= \tilde{\kappa}\kappand\ofr,\\
		\andd \eta\ofr &= \tilde{\eta}\etand\ofr. \label{eq:ndschemeeta} 
	\end{align}
	\end{subequations}
	Here, $L$ is a typical length-scale, $\tau$ is a typical time-scale, and $\sigma$ is a typical entropy scale. On the right-hand-sides of Equations \eqref{eq:ndschemenabla}--\eqref{eq:ndschemeb} (and in the following non-dimensionalizations), $\nabla$, $t$, $\vecu$, $S$, $P$, and $\vecb$ are all understood to be non-dimensional. In Equations \eqref{eq:ndschemerho}--\eqref{eq:ndschemeeta}, the tildes refer to``typical values" of the reference state functions and the hats refer to the radially-dependent non-dimensional versions of the reference-state functions. 
	
	Below, we will assume the time scale is either a viscous diffusion time (i.e., $\tau=L^2/\tilde{\nu}$) or a rotational time-scale (i.e., $\tau=\Omega_0^{-1}$). To describe the reference state, we will consider three cases for a given function's ``typical value": Its value at the inner shell boundary, its value at the outer shell boundary, or its value volume-averaged over the shell. 
	
	\section{Non-Dimensional Equations; $\tau=L^2/\tilde{\nu}$}
	In this case, Equations \eqref{eq:contdim}--\eqref{eq:inddim} become 
	\begin{align}
	\Div[\rhond\ofr\vecu] &= 0\label{eq:contndvisc},\\
	\Div \vecb &= 0,
\end{align}
\begin{subequations}\label{eq:momndvisc}
	\begin{align}
		\rhond\ofr\left[\matderiv{\vecu}+\frac{2}{\ek}\ez\times\vecu\right] = &-\rhond\ofr\nabla\left[ \frac{P}{\rhond\ofr} \right] + \frac{\ra}{\pr}\rhond\ofr\gnd\ofr S\er, \nonumber\\
		&+\Div\bm{D} +(\curl\vecb)\times\vecb,\\
		\where D_{ij} &\define 2\rhond\ofr\nund\ofr \left[e_{ij} - \frac{1}{3}(\Div\vecu) \delta_{ij} \right]\\
		\andd e_{ij} &\define \frac{1}{2}\left(\pderiv{u_i}{x_j} + \pderiv{u_j}{x_i} \right),
	\end{align}
\end{subequations}
\begin{align}\label{eq:enndvisc}
	\rhond\ofr\tmpnd\ofr \matderiv{S} = &- \frac{\pr}{\ra}\bvisc\rhond\ofr\tmpnd\ofr \frac{\widehat{N^2}\ofr}{\hat{g}\ofr} \ur + \frac{1}{\pr} \Div[\rhond\ofr \tmpnd\ofr \kappand\ofr \nabla S] \nonumber \\
	&+ \frac{1}{\pr} \hat{Q}(r) + \frac{\pr\di}{\ra} D_{ij}e_{ij} + \frac{\pr\di}{\prm\ra} \etand\ofr|\curl\vecb|^2,
\end{align}
\begin{align}\label{eq:indndvisc}
	\andd \pderiv{\vecb}{t} = \curl(\vecu\times\vecb) - \frac{1}{\prm} \curl[\eta\ofr\curl\vecb].
\end{align}	

The non-dimensional numbers appearing are:
\begin{subequations}
\begin{align}
	\ra &\define \frac{\tilde{g} L^3}{\tilde{\nu} \tilde{\kappa}} \frac{\sigma}{\cp},\\ 
	\pr &\define \frac{\tilde{\nu}}{\tilde{\kappa}},\\
	\prm &\define \frac{\tilde{\nu}}{\tilde{\eta}},\\
	\ek &\define \frac{\tilde{\nu}}{\Omega_0H^2},\\	
	\bvisc &\define \frac{\widetilde{N^2}L^4}{\tilde{\nu}^2},\\
	\andd \di &= \frac{\tilde{g}L}{\cp\tilde{T}},
\end{align}
\end{subequations}
along with the non-dimensional heating function
\begin{align}\label{eq:qnd}
	\hat{Q}(r) \define \frac{L^2}{\tilde{\rho}\tilde{T}\tilde{\kappa} \sigma} Q(r). 
\end{align}

Note that the dissipation number is not an independent control parameter, but a function of the non-dimensional parameters characterizing the polytrope. 

In general, $\hat{Q}(r)$ is simply an arbitrary---hopefully order unity---function. Assuming the thermal boundary conditions remove whatever $\hat{Q}(r)$ dumps in: If $\hat{Q}(r)\gg1$, the user is dilating their Rayleigh number without saying so. If $\hat{Q}\ll1$, the user is contracting their Rayleigh number without saying so. If $\hat{Q}(r)\equiv0$ (and the user wants to simulate a convection zone), the user should typically identify $\sigma$ with $-\Delta S=S\inn-S\out$ (the imposed entropy drop across the layer) and thus set $S\equiv1$ at $r=r\inn$ and $S\equiv0$ at $r=r\out$.
 
The non-dimensional heating takes a specific form if we assume the Rayleigh number is a ``flux" Rayleigh number. In that case we identify
\begin{align}
	\sigma = \frac{L \avvol{\fluxscalar_{\rm{nr}}\ofr}}{\tilde{\rho}\tilde{T}\tilde{\kappa}},\\
	\where \fluxscalar_{\rm{nr}}\ofr \define \frac{1}{r^2}\int_{r\inn}^r Q(x) x^2 dx
\end{align}
is the flux not carried by radiation in a statistically steady state and $\avvol{\cdots}$ refers to a volume average over the whole shell. We thus have
\begin{align}\label{eq:qnorm}
	\hat{Q}(r) = \frac{L}{\avvol{\fluxscalar_{\rm{nr}}(r)}}Q(r)
\end{align}
and whatever amplitude (luminosity) the user chooses for the dimensional $Q(r)$, the ultimate $\hat{Q}(r)$ will normalize that amplitude away in Equation \eqref{eq:qnorm}. 

The viscous buoyancy number $\bvisc$ is the ratio of the typical squared buoyancy frequency to the squared viscous diffusion time (it is essentially a kind of Richardson number). Although it has to do with background entropy stratification, $\bvisc$ is nominally independent of the Rayleigh number (which derives from the entropy perturbations associated with the thermal boundary conditions and/or heating that force energy through the layer). However, the following notes are warranted: 

(1) In the typical convection problem (polytropic index $n=\nad\define1/(\gamma-1)$), $\dsdrline\equiv0$ and the value of $\bvisc$ is irrelevant. 

(2) For an isolated stable polytrope ($n>\nad$), it is unclear how the typical entropy perturbation $\sigma$ is established. Even if energy is driven through the system by the thermal boundary conditions and/or heating, the energy will likely be carried by spherically symmetric conduction (depending on how stable the stratification is) and $\sigma$ may not be set by the boundary conditions. Furthermore, $\sigma$ cannot be set by the total entropy contrast across the layer (which is $\sim$$\cp$, and if $\sigma=\cp$, we would have $\bvisc\pr = \ra$). That is because no plume can traverse a large portion of the stably stratified layer. Thus, although the user can choose a ``Rayleigh number" (probably a misnomer) for the isolated stable layer, they have no way of implementing the background state, boundary conditions, or heating profile to be consistent with their choice. 

(3) For unstable polytropes ($n<\nad$), we first note that if $n$ differs by a factor of unity from $\nad$, order-unity thermal perturbations $S/\cp$ are forced and the anelastic approximation is invalid. In any case (either if the simulation survives an order-unity $\nad-n$, or if the user chooses  a well-posed small $\nad-n$ to help drive the convection), we expect that the convection will restratify the system toward adiabaticity. In Equation \eqref{eq:endim}, a background $(dS/dr)_{\ell=0}$ will be established to be close to the negative of $\dsdrline$ and (similar to point (1)), the value of $\bvisc$ will not truly be an independent parameter, but will help to determine an ultimate ``effective" Rayleigh number. 

(4) In the more logical case of a stable layer being pummeled by a neighboring overshooting convection layer, both $\bvisc$ and $\ra$ are truly independent (and relevant). The overshooting flows (driven by $\ra$, which is a property of the convection zone) establish the typical $\sigma$ in both the convection zone and overshoot layer. Meanwhile, $\bvisc$ (which is a property of the stable layer) controls how strongly the overshoot is decelerated. 

\section{Non-Dimensional Equations; $\tau=\Omega_0^{-1}$}
In the previous section, $t$ (and things with time in the dimensions) was implied to mean $(\tilde{\nu}/H^2) t_{\rm{dim}}$, where $t_{\rm{dim}}$ was the dimensional time. We now want to use $t_{\rm{new}}= \Omega_0t_{\rm{dim}} = t/\ek$. We can thus find the new equations easily from Equations \eqref{eq:contndvisc}--\eqref{eq:indndvisc}: Every place we see a time dimension, we recall $t=\ek t_{\rm{new}}$, so we multiply the place where the dimension appears by $\ek$ and drop the ``new" subscript (e.g., $t\rightarrow \ek\ t$, $\vecu\rightarrow\vecu/\ek$, etc.).  We thus find (after rearranging terms)
\begin{align}
	\Div[\rhond\ofr\vecu] &= 0\label{eq:contndrot},\\
	\Div \vecb &= 0,
\end{align}
\begin{subequations}\label{eq:momndrot}
	\begin{align}
		\rhond\ofr\left[\matderiv{\vecu} + 2\ez\times\vecu\right] = &-\rhond\ofr\nabla\left[ \frac{P}{\rhond\ofr} \right] + \ramod \rhond\ofr\gnd\ofr S\er, \nonumber\\
		&+ \ek \Div\bm{D} +(\curl\vecb)\times\vecb,\\
		\where D_{ij} &\define 2\rhond\ofr\nund\ofr \left[e_{ij} - \frac{1}{3}(\Div\vecu) \delta_{ij} \right]\\
		\andd e_{ij} &\define \frac{1}{2}\left(\pderiv{u_i}{x_j} + \pderiv{u_j}{x_i} \right),
	\end{align}
\end{subequations}
\begin{align}\label{eq:enndrot}
	\rhond\ofr\tmpnd\ofr \matderiv{S} = &- \frac{\brot}{\ramod} \rhond\ofr\tmpnd\ofr \frac{\widehat{N^2}\ofr}{\hat{g}\ofr} \ur + \frac{\ek}{\pr} \Div[\rhond\ofr \tmpnd\ofr \kappand\ofr \nabla S] \nonumber \\
	&+ \frac{\ek}{\pr} \hat{Q}(r) + \frac{\di\ek}{\ramod} D_{ij}e_{ij} + \frac{\di\ek}{\prm\ramod} \etand\ofr|\curl\vecb|^2,
\end{align}
\begin{align}\label{eq:indndrot}
	\andd \pderiv{\vecb}{t} = \curl(\vecu\times\vecb) - \frac{\ek}{\prm} \curl[\eta\ofr\curl\vecb].
\end{align}	

The new non-dimensional numbers appearing are:
\begin{subequations}
	\begin{align}
		\ramod &\define \frac{\ek^2}{\pr}\ra =  \frac{\tilde{g} }{L\Omega_0^2} \frac{\sigma}{\cp},\\ 
		\andd \brot &\define \ek^2 \bvisc = \frac{\widetilde{N^2}} {\Omega_0^2} \sim \frac{\tilde{g} }{L\Omega_0^2} =  \frac{1}{\text{oblateness\ factor}}.
	\end{align}

Note that although the ``$\dsdrline$-terms" in the non-dimensionalizations have seemingly different definitions, they are the same, since:
\begin{align}
	\frac{\pr}{\ra}\bvisc = \frac{\brot}{\ramod} \sim \frac{\cp}{\sigma}.
\end{align}
\end{subequations}

\section{Non-Dimensional Polytrope}
A polytrope depends on the following four non-dimensional parameters:
\begin{subequations}
\begin{alignat}{2}
	\gamma &\define \frac{\cp}{\cv} &\five \text{specific-heat ratio} ,\\
	0 \leq n &\leq \infty &\five \text{polytropic index},\\
	\nrho &\define \ln\left(\frac{\rhoref\inn}{\rhoref\out} \right) &\five \text{number of density scale-heights},\\
	\andd \beta &= \frac{r\inn}{r\out} &\five \text{aspect ratio}. 
\end{alignat}
\end{subequations}

If the typical values of the polytrope are taken at the inner boundary, we have
\begin{subequations}\label{eq:ndpoly}
\begin{align}
	\hat{T}\ofr = \frac{\tmpref\ofr}{\tmpref\inn} &= \left[\frac{\beta(1 - e^{-\nrho/n})}{(1-\beta)^2 } \right]  \left(\frac{H}{r}\right)  - \left(\frac{ \beta - e^{-\nrho/n} }{1 - \beta} \right)
	\label{eq:tmppolynd}
	\\
	\hat{\rho}\ofr = \frac{\rhoref\ofr}{\rhoref\inn} &= \left\{  \left[\frac{\beta(1 - e^{-\nrho/n})}{(1-\beta)^2 } \right]  \left(\frac{H}{r}\right)  - \left(\frac{ \beta - e^{-\nrho/n} }{1 - \beta} \right)    \right\}^n,
	\label{eq:rhopolynd}
	\\
	\widehat{N^2}\ofr =  \frac{N^2\ofr}{\widetilde{N^2}} &=  \left(\frac{r\inn}{r}\right)^3 \left[\frac{1-e^{-\nrho/n}}{1-\beta} -  \left( \frac{\beta - e^{-\nrho/n}} {\beta} \right) \frac{r}{H} \right]^{-1}, 
	\label{eq:dsdrpolynd}
	\\
	\hat{g}\ofr = \frac{g\ofr}{g\inn} &= \frac{r\inn^2}{r^2},
	\\
	\andd \di &= \frac{L}{H} \left(\frac{n+1}{\tilde{n}+1}\right)  \left(\frac{1}{\beta} \right) (1 - e^{-\nrho/n}),
\end{align}
\end{subequations}
where $H=r\out-r\inn$ is the shell depth. 

Note that the range on $r/H$ is (by definition)
\begin{align}
	\frac{\beta}{1-\beta}\leq \frac{r}{H} \leq \frac{1}{1-\beta}. 
\end{align}

If instead we take the typical values at the outer boundary, it is simple to compute the ratios from outer to inner directly from Equations \eqref{eq:ndpoly} and thus change the non-dimensionalization of the polytrope. 

If we instead take the typical values as volume-averages, the density profile in Equations \eqref{eq:ndpoly} (because of the $n$ exponent) must be integrated numerically (or else computed from the hypergeometric function) but it is again straightforward to re-scale. Because the formulas are complicated (and I am error-prone), it is easiest to numerically integrate the other functions as well. We note, however, the analytic formula for $\di$ when volume averages are used: 
\begin{align}\label{eq:digory}
	\di_{\rm{v}} &\define \frac{\avvol{g}/g\inn}{\avvol{\tmpref}/\tmpref\inn}\di \nonumber\\
	&= \frac{L}{H}\left(\frac{n+1}{\tilde{n}+1}\right)   \frac{3 \beta (1 - \beta)^2 (1 - e^{-\nrho/n})} 
	{ (3\beta/2) (1 - \beta^2) (1 - e^{-\nrho/n}) - (1-\beta^3)(\beta-e^{-\nrho/n})}. 
\end{align}
This emphases the fact that $\di=\di(\gamma,n,\nrho,\beta,L/H)$ is not an independent control parameter of the system. 
\end{document}